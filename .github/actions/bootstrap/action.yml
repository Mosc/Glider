name: Bootstrap
description: Bootstrap workspace
runs:
  using: composite
  steps:
    - name: Cache FVM
      uses: actions/cache@v3
      with:
        path: ~/fvm
        key: ${{ runner.os }}-fvm-${{ hashFiles('.fvmrc') }}
        restore-keys: ${{ runner.os }}-fvm-
    - name: Cache pub
      uses: actions/cache@v3
      with:
        path: ~/.pub-cache
        key: ${{ runner.os }}-pub-${{ hashFiles('**/pubspec.lock') }}
        restore-keys: ${{ runner.os }}-pub-
    - name: Set up FVM
      shell: bash
      run: curl -fsSL https://fvm.app/install.sh | bash
    - name: Set up Flutter
      shell: bash
      run: |
        fvm install
        fvm dart --disable-analytics
        fvm flutter config --disable-analytics
        echo "$HOME/.pub-cache/bin" >> $GITHUB_PATH
    - name: Set up Melos
      shell: bash
      run: fvm dart pub global activate melos
    - name: Bootstrap workspace
      shell: bash
      run: fvm dart pub global run melos bootstrap
